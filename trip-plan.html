<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ‡¹ğŸ‡­ ×™×•××Ÿ ××¡×¢ ×™×¨×— ×“×‘×© â€“ ×ª××™×œ× ×“</title>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --ring:#22d3ee;
      --brand:#38bdf8; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --ink:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Heebo, Arial, sans-serif;
      background:linear-gradient(135deg,#0b1023,#0f172a 25%,#0b2740 75%,#0b1023);
      color:var(--ink);
    }
    .container{max-width:1100px; margin:0 auto; padding:18px}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(8px);
      background:rgba(11,16,35,.6); border-bottom:1px solid #1f2937;
    }
    header .inner{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:12px 18px}
    .title{display:flex; align-items:center; gap:10px}
    .title h1{font-size:20px; margin:0}
    .title .tag{font-size:12px; color:var(--muted); border:1px solid #334155; padding:2px 8px; border-radius:999px}

    .controls{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    select, button, input[type="search"]{
      background:#0b2136; color:var(--ink); border:1px solid #1f3952; border-radius:10px; padding:8px 10px; font-family:inherit
    }
    button{cursor:pointer}
    button.primary{border-color:#2563eb; background:#0b1f3b}
    button.ghost{background:transparent}
    .chip{border:1px solid #1f3952; padding:6px 10px; border-radius:999px; cursor:pointer; user-select:none}
    .chip.active{border-color:var(--ring); box-shadow:0 0 0 2px rgba(34,211,238,.25) inset}

    .layout{display:grid; grid-template-columns: 280px 1fr; gap:16px; margin-top:16px}
    @media (max-width: 900px){ .layout{grid-template-columns:1fr} }

    .sidebar{background:rgba(17,24,39,.6); border:1px solid #1f2937; border-radius:16px; padding:14px}
    .sidebar h3{margin:0 0 8px 0; font-size:14px; color:var(--muted)}
    .days{display:grid; gap:6px; max-height:65vh; overflow:auto; padding-left:2px}
    .day-btn{display:flex; align-items:center; gap:8px; border:1px solid #1f3952; border-radius:12px; padding:8px 10px; background:#0b2136; cursor:pointer}
    .day-btn small{color:var(--muted)}
    .day-btn .progress{margin-inline-start:auto; font-size:12px; color:#a7f3d0}
    .day-btn.active{border-color:var(--ring); box-shadow:0 0 0 2px rgba(34,211,238,.25) inset}

    .card{background:rgba(17,24,39,.7); border:1px solid #1f2937; border-radius:18px; padding:18px}
    .card h2{margin:0 0 8px 0}
    .meta{display:flex; flex-wrap:wrap; gap:10px; color:var(--muted); font-size:14px}
    .badge{border:1px solid #334155; padding:4px 8px; border-radius:999px; font-size:12px; color:#cbd5e1}

    .todo{margin-top:14px; display:grid; gap:10px}
    .todo-item{display:flex; gap:10px; align-items:flex-start; background:#0b2136; border:1px solid #1f3952; border-radius:12px; padding:10px}
    .todo-item input{accent-color:var(--ok); margin-top:2px}

    .actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}

    .notice{margin-top:14px; background:#0b1f3b; border:1px dashed #334155; color:#cfe7ff; padding:12px; border-radius:12px}

    .divider{height:1px; background:#1f2937; margin:12px 0}

    .print{position:fixed; bottom:14px; left:14px; display:flex; gap:8px}

    .tests{margin-top:16px; font-size:13px; color:#cbd5e1}
    .tests summary{cursor:pointer}
    .tests pre{white-space:pre-wrap; background:#0b2136; border:1px solid #1f3952; padding:10px; border-radius:10px}
  </style>
</head>
<body>
  <header>
    <div class="inner container">
      <div class="title">
        <div style="font-size:22px">ğŸ‡¹ğŸ‡­</div>
        <h1>×™×•××Ÿ ××¡×¢ ×™×¨×— ×“×‘×© â€“ ×ª××™×œ× ×“</h1>
        <span class="tag">RTL â€¢ ×§×•×‘×¥ ××—×“ â€¢ ×©××™×¨×” ××§×•××™×ª</span>
      </div>
      <div class="controls">
        <input id="search" type="search" placeholder="×—×™×¤×•×© ×‘×™×•× ×”× ×•×›×—×™" />
        <button class="ghost" id="prev">×™×•× ×§×•×“×</button>
        <select id="jump"></select>
        <button class="ghost" id="next">×™×•× ×”×‘×</button>
        <button class="primary" id="toggleSection">×¡× ×Ÿ ×œ×¤×™ ××–×•×¨</button>
      </div>
    </div>
  </header>

  <main class="container layout">
    <aside class="sidebar" aria-label="×¨×©×™××ª ×™××™×">
      <h3 id="daysTitle">×”×™××™× ×‘××¡×œ×•×œ</h3>
      <div class="days" id="days"></div>
      <div class="divider"></div>
      <h3>××–×•×¨×™×</h3>
      <div class="badges" id="zones"></div>
    </aside>

    <section id="content">
      <article class="card" id="card"></article>
      <div class="print">
        <button id="printBtn">×”×“×¤×¡/×™×™×¦× PDF</button>
        <button id="exportBtn">×™×™×¦×•× ×˜×•×“×• (.json)</button>
        <button id="importBtn">×™×™×‘×•× ×˜×•×“×•</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button id="testBtn" title="×›×œ×™ ×œ××¤×ª×—×™×">×”×¨×¥ ×‘×“×™×§×•×ª</button>
      </div>
      <details class="tests" id="testsPanel" style="display:none">
        <summary>×ª×•×¦××•×ª ×‘×“×™×§×•×ª</summary>
        <pre id="testsOut">â€”</pre>
      </details>
    </section>
  </main>

  <script>
  // ===== × ×ª×•× ×™ ×”××¡×œ×•×œ (30 ×™××™× ××œ××™×) =====
  const itinerary = [
    // ×™×•× 1 â€“ ×‘× ×’×§×•×§ (× ×—×™×ª×”)
    {day:1, zone:'×‘× ×’×§×•×§', title:'× ×—×™×ª×” ×•×”×ª××§×œ××•×ª', location:'×‘× ×’×§×•×§', tip:'×¡×™×/××™×¡×™× ××™×“ ××—×¨×™ ×”× ×—×™×ª×”; Grab ×¨×©××™; ××©×›×• ××–×•××Ÿ ×‘×¤×¢× ××—×ª ×œ×¦××¦×•× ×¢××œ×•×ª.',
      todo:['× ×—×™×ª×” ~13:50, ×‘×™×§×•×¨×ª ×’×‘×•×œ×•×ª','×¡×™×/××™×¡×™×, ××©×™×›×ª ××–×•××Ÿ','Grab ×œ××œ×•×Ÿ, ××§×œ×—×ª ×•×× ×•×—×”','×”×œ×™×›×” ×¨×›×”/×§× ×™×•×Ÿ ×××•×–×’','××¨×•×—×” ×§×œ×” ×•×©×™× ×” ××•×§×“××ª']},

    // ×™×•× 2 â€“ ×˜×™×¡×” ×œ×¦×³×™×× ×’ ×××™
    {day:2, zone:'×¦×¤×•×Ÿ', title:'×˜×™×¡×” ×œ×¦×³×™×× ×’ ×××™', location:'×¦×³×™×× ×’ ×××™ (×¢×™×¨ ×¢×ª×™×§×”)', tip:'×‘×“×§×• ×× ×”×˜×™×¡×” ××“×•×Ÿ ××•×× ×’/×¡×•×‘××¨× ××‘×•××™. ×œ×”×’×™×¢ ~×©×¢×ª×™×™× ×œ×¤× ×™.',
      todo:['××•× ×™×ª ×œ×©×“×”, ×˜×™×¡×” ~1:15','×¦×³×§-××™×Ÿ ×‘×¢×™×¨ ×”×¢×ª×™×§×”','×¡×™×‘×•×‘ ×¨××©×•×Ÿ ×•××¡××–×³']},

    // ×¦×³×™×× ×’ ×××™ + ×¤××™
    {day:3, zone:'×¦×¤×•×Ÿ', title:'×“×•×™ ×¡×•×˜×¤ ×•×ª×¦×¤×™×•×ª', location:'×¦×³×™×× ×’ ×××™', tip:'×›×ª×¤×™×™×/×‘×¨×›×™×™× ××›×•×¡×•×ª. ×¦×¢×™×£ ×“×§ ×‘×ª×™×§ ×¤×•×ª×¨ ×”×›×œ.',
      todo:['Doi Suthep ××•×§×“×','×§×¤×” ×•×ª×¦×¤×™×ª','× ×”×¨ ×¤×™× ×’ ×‘×¢×¨×‘']},
    {day:4, zone:'×¦×¤×•×Ÿ', title:'×©×™×¢×•×¨ ×‘×™×©×•×œ ×•×©×•×•×§×™×', location:'×¦×³×™×× ×’ ×××™', tip:'×¦×œ××• ××ª×›×•× ×™× ×•×©××¨×• ×‘-Notes. ×©×§×™×ª ×‘×“ ×¨×‘-×¤×¢××™×ª.',
      todo:['×©×™×¢×•×¨ ×‘×™×©×•×œ','Warorot Market','Night Bazaar (×× ×¤×ª×•×—)']},
    {day:5, zone:'×¦×¤×•×Ÿ', title:'××§×“×©×™× ×§×˜× ×™× ×•×§×¤×”', location:'×¦×³×™×× ×’ ×××™', tip:'×‘×ª×™ ×§×¤×” ××¢×•×œ×™× ××¤×•×–×¨×™× ×‘×¡××˜××•×ª â€“ ×œ×›×• ×¨×’×œ×™ ×•×ª×’×œ×• ×¤× ×™× ×™×.',
      todo:['××§×“×©×™× ×‘×¢×™×¨ ×”×¢×ª×™×§×”','×‘×ª×™ ×§×¤×”/×§×™×©×•×˜×™× ×œ×¦×™×œ×•×','×¢×¨×‘ ×¨×’×•×¢']},

    {day:6, zone:'×¦×¤×•×Ÿ', title:'× ×¡×™×¢×” ×œ×¤××™ â€“ ×§× ×™×•×Ÿ ×©×§×™×¢×”', location:'×¤××™ (1/3)', tip:'×œ×›×‘×™×© ×œ×¤××™ â€“ ×›×“×•×¨×™ ××—×œ×ª × ×¡×™×¢×” ×× ×¦×¨×™×š, ×¢×¦×™×¨×•×ª ×§×¦×¨×•×ª.',
      todo:['××™× ×™×•×•××Ÿ ~3 ×©×³','×¦×³×§-××™×Ÿ ×œ×‘×•× ×’×œ×•','Pai Canyon ×œ×©×§×™×¢×”']},
    {day:7, zone:'×¦×¤×•×Ÿ', title:'×¤××™ â€“ ××™× ×—××™× ×•××¤×œ×™×', location:'×¤××™ (2/3)', tip:'×œ××¢×™×™× ×•×ª â€“ ×œ×”×¡×™×¨ ×ª×›×©×™×˜×™×; ×¡× ×“×œ×™ ××™× ×œ××¤×œ×™×.',
      todo:['Sai Ngam Hot Springs','Pam Bok Waterfall','×©×•×§ ×œ×™×œ×”']},
    {day:8, zone:'×¦×¤×•×Ÿ', title:'×¤××™ ××™×˜×™×ª â€“ ×–×•×’×™×•×ª', location:'×¤××™ (3/3)', tip:'×©×›×™×¨×ª ×§×˜× ×•×¢? ×¦×œ××• ××ª ×”×›×œ×™ ××›×œ ×”×›×™×•×•× ×™× ×•×‘×“×§×• ×‘×™×˜×•×—.',
      todo:['×§×¤×” ××•×œ ×©×“×•×ª','×¡×™×‘×•×‘ ×›×¤×¨×™ ×§×œ','××¨×•×—×ª ×¢×¨×‘ ×—××™××”']},
    {day:9, zone:'×¦×¤×•×Ÿ', title:'×—×–×¨×” ×œ×¦×³×™×× ×’ ×××™ â€“ ×œ×™× ×ª ××¢×‘×¨', location:'×¦×³×™×× ×’ ×××™ (××¢×‘×¨)', tip:'×›×‘×™×¡×” wash & fold ×‘×‘×•×§×¨ ×ª×—×–×•×¨ ×‘×¢×¨×‘.',
      todo:['× ×¡×™×¢×” ×—×–×¨×”','×›×‘×™×¡×” ×•×× ×•×—×”','××¨×™×–×ª ×§×œ ×œ×˜×™×¡×” ×“×¨×•××”']},

    // ×¡××•×™
    {day:10, zone:'××™×™×', title:'×˜×™×¡×” ×œ×§×•×¡××•×™ â€“ ×©×§×™×¢×” ×¨××©×•× ×”', location:'×§×• ×¡××•×™ (1/4)', tip:'×§×¨× ×™×“×™×“×•×ª×™ ×œ×©×•× ×™×•×ª. ×œ×× ×’Ö¾×ª×³×•× ×’ â€“ ×œ×”×™×¨×©× ×™×•× ×§×•×“×.',
      todo:['×˜×™×¡×” ××¦×³×™×× ×’ ×××™ ×œ×¡××•×™','×¦×³×§-××™×Ÿ ×œ×¨×™×–×•×¨×˜ ×—×•×£','×©×§×™×¢×” ×¢×œ ×”×—×•×£']},
    {day:11, zone:'××™×™×', title:'×¡××•×™ â€“ ××¤×œ×™× ×•××§×“×©×™×', location:'×§×• ×¡××•×™ (2/4)', tip:'× ×¢×œ×™×™× ×©××™× ×Ÿ ××—×œ×™×§×•×ª ×œ××¤×œ×™×.',
      todo:['Na Muang Waterfalls','Big Buddha ×‘×©×¢×ª ×–×”×‘']},
    {day:12, zone:'××™×™×', title:'×¡××•×™ â€“ ×× ×’ ×ª×³×•× ×’ / ×¦×³×™×œ', location:'×§×• ×¡××•×™ (3/4)', tip:'×œ×©×™×˜ â€“ Dry bag, ×›×•×‘×¢, ×ª×¨×•×¤×•×ª ×œ×™×.',
      todo:['×©×™×˜/×¡× ×•×¨×§×œ ×œ×× ×’Ö¾×ª×³×•× ×’ (××–×’ ××•×•×™×¨)','×—×œ×•×¤×”: ×™×•× ×¦×³×™×œ']},
    {day:13, zone:'××™×™×', title:'×¡××•×™ â€“ ×—×•×¤×©×™', location:'×§×• ×¡××•×™ (4/4)', tip:'×‘×—×¨×• ×—×•×£ ×‘×¡×™×¡ ×•×—×–×¨×• ××œ×™×• â€“ ×¤×—×•×ª ×œ×•×’×™×¡×˜×™×§×”, ×™×•×ª×¨ × ×—×ª.',
      todo:['×™×/×¡×¤×¨/×§×¤×”','×©×§×™×¢×” × ×™× ×•×—×”']},

    // ×§×•×¤× ×’×Ÿ (7 ×œ×™×œ×•×ª)
    {day:14, zone:'××™×™×', title:'××¢×‘×•×¨×ª ×œ×§×•×¤× ×’×Ÿ â€“ ×”×ª××§××•×ª', location:'×§×•×¤× ×’×Ÿ (1/7)', tip:'×‘×“×§×• ×–×× ×™ ×’××•×ª/×©×¤×œ â€“ ××©× ×” ××ª ×”×—×•×£.',
      todo:['××¢×‘×•×¨×ª ×§×¦×¨×”','×¦×³×§-××™×Ÿ ×‘××¤×¨×¥ ×©×§×˜','× ×§×•×“×ª ×©×§×™×¢×”']},
    {day:15, zone:'××™×™×', title:'×§×•×¤× ×’×Ÿ â€“ ×—×•×¤×™× ××¢×¨×‘×™×™×', location:'×§×•×¤× ×’×Ÿ (2/7)', tip:'Secret Beach × ×”×“×¨ ×œ×©×§×™×¢×” ×¢×“×™× ×”.',
      todo:['Haad Yao/Secret Beach','×§×¤×” ××•×œ ×”×™×']},
    {day:16, zone:'××™×™×', title:'×§×•×¤× ×’×Ÿ â€“ ×©×‘×™×œ ×™×¨×•×§ ×•×§×¤×”', location:'×§×•×¤× ×’×Ÿ (3/7)', tip:'×™×ª×•×©×™× ×¤×¢×™×œ×™× ×‘×¢×¨×‘ â€“ ×¡×¤×¨×™×™ ×¢× DEET.',
      todo:['×”×œ×™×›×” ×§×œ×” ×‘×™×¢×¨','×‘×ª×™ ×§×¤×” ×©×§×˜×™×','×©×•×§ ×œ×™×œ×”']},
    {day:17, zone:'××™×™×', title:'×§×•×¤× ×’×Ÿ â€“ ×™×•× ××™×', location:'×§×•×¤× ×’×Ÿ (4/7)', tip:'×‘×¡× ×•×¨×§×œ â€“ ×œ× ×œ×’×¢×ª ×‘××œ××•×’×™×; ××¡×›×” ××™×©×™×ª ×¢×“×™×¤×”.',
      todo:['×¡× ×•×¨×§×œ/×¦×œ×™×œ×” ×”×™×›×¨×•×ª','××¨×•×—×ª ×“×’×™× ×¤×©×•×˜×”']},
    {day:18, zone:'××™×™×', title:'×§×•×¤× ×’×Ÿ â€“ ×™×•×’×”/×¡×“× ×”', location:'×§×•×¤× ×’×Ÿ (5/7)', tip:'×‘×§×‘×•×§ ×¨×‘-×¤×¢××™ ×•× ×¢×œ×™ ×”×œ×™×›×” ×§×œ×•×ª.',
      todo:['×¡×“× ×ª ×™×•×’×” ×‘×•×§×¨','×–××Ÿ ×× ×•×—×”','×©×§×™×¢×” Amsterdam Bar (×× ××ª××™×)']},
    {day:19, zone:'××™×™×', title:'×§×•×¤× ×’×Ÿ â€“ ×—×•×¤×©×™', location:'×§×•×¤× ×’×Ÿ (6/7)', tip:'×’×™×‘×•×™ ×ª××•× ×•×ª: ×¢× ×Ÿ + ×›×¨×˜×™×¡.',
      todo:['×—×•×£ ××”×•×‘ ×—×•×–×¨×™×','×§×¤×” ××•×¢×“×£','×§×¦×ª ×©×•×¤×™× ×’ ××§×•××™']},
    {day:20, zone:'××™×™×', title:'×§×•×¤× ×’×Ÿ â€“ ×—×•×¤×©×™ × ×•×¡×£', location:'×§×•×¤× ×’×Ÿ (7/7)', tip:'×œ×ª×›× ×Ÿ ××¢×‘×¨ ×œ××—×¨ â€“ ×›×¨×˜×™×¡×™×/×–×× ×™× ××•×›× ×™×.',
      todo:['×‘×•×§×¨ ×™× ×¨×’×•×¢','××¨×™×–×ª ××¢×‘×¨']},

    // ×¨×™×™×œ×™/×§×¨××‘×™ (4 ×œ×™×œ×•×ª)
    {day:21, zone:'×¨×™×™×œ×™/×§×¨××‘×™', title:'××¢×‘×¨ ×œ×™×‘×©×” â†’ ×¨×™×™×œ×™', location:'×¨×™×™×œ×™ (1/4)', tip:'×”×©××™×¨×• ××¨×•×•×—×™ ×–××Ÿ ×‘××¢×‘×¨×™×; ×›×¨×˜×™×¡×™× ×“×™×’×™×˜×œ×™×™× ×–××™× ×™×.',
      todo:['××¢×‘×•×¨×ª/×™×‘×©×” ×œ×¡×•×¨×˜×³×× ×™/×“×•× ×¡××§','×¨×›×‘ ×œ-Ao Nang + Longtail ×œ×¨×™×™×œ×™','×¤×¨× × × ×’ ×œ×©×§×™×¢×”']},
    {day:22, zone:'×¨×™×™×œ×™/×§×¨××‘×™', title:'×¨×™×™×œ×™ â€“ ×§×™××§ ×§×œ', location:'×¨×™×™×œ×™ (2/4)', tip:'××¨×—×• ×§×¨× ×”×’× ×” ××¨××©; ×œ××•×–× ×™×™× ×¨×’×™×©×•×ª â€“ ××˜××™×.',
      todo:['×§×™××§ ×œ××•×¨×š ×”×¦×•×§×™×','×× ×•×—×” ×‘×—×•×£']},
    {day:23, zone:'×¨×™×™×œ×™/×§×¨××‘×™', title:'×¡×™×•×¨ â€œ4 ××™×™×â€', location:'×¨×™×™×œ×™ (3/4)', tip:'××–×•××Ÿ ×§×˜×Ÿ ×œ×“××™ ×›× ×™×¡×” ×•××’×‘×ª ××™×§×¨×•×¤×™×™×‘×¨.',
      todo:['×©×™×˜ Longtail (×× ×”×™× × ×•×—)','×¡× ×•×¨×§×œ ×§×¦×¨','××¨×•×—×ª ×“×’×™×']},
    {day:24, zone:'×¨×™×™×œ×™/×§×¨××‘×™', title:'×¨×™×™×œ×™ â€“ × ×©×™××”', location:'×¨×™×™×œ×™ (4/4)', tip:'×”×œ×™×›×” ×œ× ×§×•×“×ª ×ª×¦×¤×™×ª ×¨×§ ×× ×”×™×‘×©×•×ª ×™×‘×©×•×ª ×•×œ× ××—×œ×™×§×•×ª.',
      todo:['×”×œ×™×›×” ×§×œ×”/×ª×¦×¤×™×ª','×¡×¤×/××¡××–×³','××¨×™×–×ª ××¢×‘×¨ ×œ×‘× ×’×§×•×§']},

    // ×‘× ×’×§×•×§ (5 ×™××™×)
    {day:25, zone:'×‘× ×’×§×•×§', title:'×˜×™×¡×” ×œ×‘× ×’×§×•×§ â€“ ×”×ª××§××•×ª', location:'×‘× ×’×§×•×§ (1/5)', tip:'×‘-BTS/MRT ×ª×—×¡×›×• ×¤×§×§×™×. ×©×§×œ×• Rabbit Card.',
      todo:['×˜×™×¡×”/× ×¡×™×¢×” ××”×“×¨×•× ×œ×‘× ×’×§×•×§','×¦×³×§-××™×Ÿ ×‘××¨×›×–','×©×™×˜ ×§×¦×¨ ×¢×œ ×”× ×”×¨']},
    {day:26, zone:'×‘× ×’×§×•×§', title:'×§×œ××¡×™×§×•×ª â€“ ××¨××•×Ÿ/×•×•××˜ ×¤×•', location:'×‘× ×’×§×•×§ (2/5)', tip:'×–×”×¨×• ×××™ ×©××•××¨ "×”××¨××•×Ÿ ×¡×’×•×¨". ×œ×”×’×™×¢ ××•×§×“×.',
      todo:['Grand Palace','Wat Pho','×©×§×™×¢×” ×‘-Rooftop']},
    {day:27, zone:'×‘× ×’×§×•×§', title:'××•×“×¨× ×™ ×•×§×•×œ×™× ×¨×™×”', location:'×‘× ×’×§×•×§ (3/5)', tip:'×¦×³×™×™× ×” ×˜××•×Ÿ â€“ ×œ×”×’×™×¢ ××•×§×“×/×××•×—×¨ ×œ×—××•×§ ××¢×•××¡ ×•×—×•×.',
      todo:['ICONSIAM/×‘×™×ª ×’×³×™× ×ª×•××¤×¡×•×Ÿ','Chinatown â€“ ××•×›×œ ×¨×—×•×‘','××¡××–×³ ××—×¨×•×Ÿ']},
    {day:28, zone:'×‘× ×’×§×•×§', title:'×’×™×—×” â€“ ××™×•×ª××™×”/×©×•×§ ×¦×£', location:'×‘× ×’×§×•×§ (4/5)', tip:'×‘×—×¨×• ××•×¤× ×™×™×/×˜×•×§-×˜×•×§ ×œ×¤×™ ××–×’ ××•×•×™×¨. ×›×•×‘×¢ ×•××™×.',
      todo:['××™×•×ª××™×” ××• ×©×•×§ ×¦×£','×—×–×¨×” ×œ×©×§×™×¢×” ×¢×œ ×”× ×”×¨']},
    {day:29, zone:'×‘× ×’×§×•×§', title:'×™×•× ×—×•×¤×©×™ ××—×¨×•×Ÿ', location:'×‘× ×’×§×•×§ (5/5)', tip:'VAT Refund ××¤×©×¨×™ ××¢×œ ×¡×£ â€“ ×©××¨×• ×§×‘×œ×•×ª ×•×“×¨×›×•×Ÿ.',
      todo:['×§× ×™×•×ª ××—×¨×•× ×•×ª','×’×™×‘×•×™ ×ª××•× ×•×ª','×¡×™×“×•×¨ ×ª×™×§×™× ×œ×˜×™×¡×”']},

    // ×—×–×•×¨
    {day:30, zone:'×˜×™×¡×” ×—×–×¨×”', title:'BKK â†’ TLV (LY84)', location:'×˜×™×¡×” ×—×–×¨×” ×œ×™×©×¨××œ', tip:'×‘×“×§×• ××©×§×œ×™× ××¨××©. ×œ×©×“×” ×œ×¦××ª ××•×§×“× (×”××¨××” 16:30).',
      todo:['×¦×³×§-×××•×˜ ×•× ×¡×™×¢×” ×œ×©×“×”','×”××¨××” 16:30, × ×—×™×ª×” 22:45','×”×•×“×¢×•×ª ×”×’×¢×ª×™ ×”×‘×™×ª×” :)']}
  ];

  // ===== ××–×•×¨×™× ×•××™×¤×•×™ ×ª××¨×™×›×™× =====
  const zonesOrder = ['×‘× ×’×§×•×§','×¦×¤×•×Ÿ','××™×™×','×¨×™×™×œ×™/×§×¨××‘×™','×˜×™×¡×” ×—×–×¨×”'];
  const startDate = new Date('2026-01-01'); // ×™×•× 1
  function dayToDate(day){ const d=new Date(startDate); d.setDate(d.getDate()+(day-1)); return d; }
  function fmt(d){ const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const yy=d.getFullYear(); return `${dd}.${mm}.${yy}`; }

  // ===== ××—×¡×•×Ÿ ××¦×‘ ××§×•××™ =====
  const keyFor = (day)=>`hm_th_itin_day_${day}`;
  function loadDayState(day){ try{ return JSON.parse(localStorage.getItem(keyFor(day))) || {}; } catch{ return {}; } }
  function saveDayState(day, state){ localStorage.setItem(keyFor(day), JSON.stringify(state)); renderSidebar(); }

  // ===== ×¨×›×™×‘×™ DOM =====
  const daysEl = document.getElementById('days');
  const cardEl = document.getElementById('card');
  const jumpEl = document.getElementById('jump');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const zonesEl = document.getElementById('zones');
  const searchEl = document.getElementById('search');
  const daysTitleEl = document.getElementById('daysTitle');

  // ===== ××¦×‘ ××¤×œ×™×§×¦×™×” =====
  let current = 1;
  let activeZoneFilter = null; // null = ×”×›×œ

  // ===== ×¢×–×¨×™ ×ª×¦×•×’×” =====
  function highlight(text, q){
    if(!q) return text;
    const esc = q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    return text.replace(new RegExp(esc,'gi'), m=>`<mark style="background:#a7f3d0;color:#0c4a6e;border-radius:4px;padding:0 2px">${m}</mark>`);
  }

  function renderJump(){
    jumpEl.innerHTML = itinerary
      .map(d=>`<option value="${d.day}">×™×•× ${d.day} â€¢ ${fmt(dayToDate(d.day))} â€¢ ${d.location}</option>`)
      .join('');
    jumpEl.value = String(current); // ×ª××™×“ ××¦×™×’ ××ª ×›×œ ×”×™××™×
  }

  function dayProgress(day){
    const d = itinerary.find(x=>x.day===day);
    const s = loadDayState(day);
    const done = (d.todo||[]).filter((_,i)=>s[i]).length;
    return {done, total:(d.todo||[]).length};
  }

  function renderSidebar(){
    const list = itinerary.filter(d=>!activeZoneFilter || d.zone===activeZoneFilter);
    daysEl.innerHTML = list.map(d=>{
      const {done,total} = dayProgress(d.day);
      const pct = total? Math.round(done/total*100):0;
      const active = d.day===current? 'active':'';
      const dateStr = fmt(dayToDate(d.day));
      return `<button class="day-btn ${active}" data-day="${d.day}">
        <div><strong>×™×•× ${d.day}</strong><br><small>${dateStr} Â· ${d.location}</small></div>
        <div class="progress">${done}/${total} â€¢ ${pct}%</div>
      </button>`;
    }).join('');
  }

  function renderZones(){
    zonesEl.innerHTML = zonesOrder.map(z=>{
      const active = z===activeZoneFilter ? 'active':'';
      return `<div class="chip ${active}" data-zone="${z}">${z}</div>`;
    }).join('');
  }

  function renderDay(){
    const d = itinerary.find(x=>x.day===current);
    if(!d) return;
    const state = loadDayState(d.day);
    const list = (d.todo||[]).map((t,i)=>{
      const checked = state[i] ? 'checked' : '';
      const text = highlight(t, searchEl.value.trim());
      return `<label class="todo-item">
        <input type="checkbox" data-idx="${i}" ${checked} />
        <div>${text}</div>
      </label>`;
    }).join('');

    const {done,total} = dayProgress(d.day);

    cardEl.innerHTML = `
      <div class="meta">
        <div class="badge">××–×•×¨: ${d.zone}</div>
        <div class="badge">××™×§×•×: ${d.location}</div>
        <div class="badge">×”×ª×§×“××•×ª: ${done}/${total}</div>
      </div>
      <h2>×™×•× ${d.day} â€“ ${fmt(dayToDate(d.day))} â€“ ${d.title}</h2>
      <div class="todo" id="todo">${list}</div>
      <div class="actions">
        <button id="markAll">×¡××Ÿ ×”×›×œ</button>
        <button id="clearAll">× ×§×” ×”×›×œ</button>
        <button id="copyDay">×”×¢×ª×§ ××ª ×”×™×•× ×œ×œ×•×—</button>
      </div>
      <div class="notice">×˜×™×¤ ×”×™×•×: <span id="tipSlot"></span></div>
    `;

    const tipSlot = document.getElementById('tipSlot');
    if(tipSlot){ tipSlot.textContent = d.tip || '×ª×”× ×• ×•×”×§×©×™×‘×• ×œ×’×•×£ â€” ×§×¦×‘ × ×™× ×•×— ×¢×•×©×” ××ª ×”×”×‘×“×œ.'; }
  }

  // ===== × ×™×•×•×˜ ×•×“×¤×“×•×£ =====
  function goTo(day){
    const list = itinerary.filter(d=>!activeZoneFilter || d.zone===activeZoneFilter);
    const ids = list.map(d=>d.day);
    if(!ids.includes(day)) day = ids[0];
    current = day;
    renderJump(); renderSidebar(); renderDay();
  }

  document.addEventListener('click', (e)=>{
    const dayBtn = e.target.closest('.day-btn');
    if(dayBtn){ goTo(Number(dayBtn.dataset.day)); return; }

    const chip = e.target.closest('.chip');
    if(chip){
      const z = chip.dataset.zone;
      activeZoneFilter = (activeZoneFilter===z)? null : z;
      renderZones(); renderSidebar();
      const list = itinerary.filter(d=>!activeZoneFilter || d.zone===activeZoneFilter);
      if(!list.find(d=>d.day===current) && list.length){ goTo(list[0].day); }
      return;
    }

    if(e.target.id==='markAll'){
      const d = itinerary.find(x=>x.day===current);
      const state={}; (d.todo||[]).forEach((_,i)=>state[i]=true);
      saveDayState(current,state); renderDay(); return;
    }
    if(e.target.id==='clearAll'){ saveDayState(current,{}); renderDay(); return; }
    if(e.target.id==='copyDay'){
      const d = itinerary.find(x=>x.day===current);
      const text = `×™×•× ${d.day} â€“ ${fmt(dayToDate(d.day))} â€“ ${d.title}\n××™×§×•×: ${d.location}\n××©×™××•×ª:\n- ` + (d.todo||[]).join('\n- ');
      navigator.clipboard.writeText(text);
      e.target.textContent='×”×•×¢×ª×§!'; setTimeout(()=>e.target.textContent='×”×¢×ª×§ ××ª ×”×™×•× ×œ×œ×•×—',1200);
      return;
    }
    if(e.target.id==='printBtn'){ window.print(); return; }
    if(e.target.id==='exportBtn'){
      const data={}; itinerary.forEach(d=>{ data[d.day]=loadDayState(d.day) });
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='honeymoon_todos.json'; a.click();
      return;
    }
    if(e.target.id==='importBtn'){ document.getElementById('importFile').click(); return; }
    if(e.target.id==='testBtn'){ document.getElementById('testsPanel').style.display='block'; runTests(); return; }
  });

  document.getElementById('importFile').addEventListener('change', (ev)=>{
    const f = ev.target.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=>{
      try{
        const data = JSON.parse(r.result);
        Object.keys(data||{}).forEach(k=>{
          localStorage.setItem(keyFor(k), JSON.stringify(data[k]||{}));
        });
        renderSidebar(); renderDay();
      }catch(err){ alert('×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ'); }
    };
    r.readAsText(f);
  });

  // ×“×¤×“×•×£ ×§×•×“×/×”×‘× â€“ ××›×‘×“ ××¡× ×Ÿ ×¤×¢×™×œ
  prevBtn.addEventListener('click', ()=>{
    const list = itinerary.filter(d=>!activeZoneFilter || d.zone===activeZoneFilter);
    const ids = list.map(d=>d.day); const idx = ids.indexOf(current);
    if(idx>0) goTo(ids[idx-1]);
  });
  nextBtn.addEventListener('click', ()=>{
    const list = itinerary.filter(d=>!activeZoneFilter || d.zone===activeZoneFilter);
    const ids = list.map(d=>d.day); const idx = ids.indexOf(current);
    if(idx<ids.length-1) goTo(ids[idx+1]);
  });
  jumpEl.addEventListener('change', ()=> goTo(Number(jumpEl.value)));
  searchEl.addEventListener('input', ()=> renderDay());

  document.addEventListener('change', (e)=>{
    if(e.target.matches('.todo-item input[type="checkbox"]')){
      const idx = Number(e.target.dataset.idx);
      const st = loadDayState(current); st[idx]=e.target.checked; saveDayState(current, st);
      renderDay();
    }
  });

  document.getElementById('toggleSection').addEventListener('click', ()=>{
    const z = itinerary.find(d=>d.day===current)?.zone;
    activeZoneFilter = (activeZoneFilter===z)? null : z;
    renderZones(); renderSidebar();
  });

  // ===== ×‘×“×™×§×•×ª (Test Cases) =====
  function runTests(){
    const out = [];
    function ok(name, cond){ out.push(`${cond?'âœ”':'âœ–'} ${name}`); if(!cond) throw new Error('Test failed: '+name); }
    try{
      // ×‘×¡×™×¡
      ok('××•×¨×š ×”××¡×œ×•×œ 30 ×™××™×', itinerary.length===30);
      ok('×™××™× ×¢×•×§×‘×™× 1..30', itinerary.every((d,i)=>d.day===i+1));
      ok('×œ×›×œ ×™×•× ×™×© ×›×•×ª×¨×ª ×•×˜×•×“×•', itinerary.every(d=>typeof d.title==='string' && Array.isArray(d.todo)));

      // ×ª××¨×™×›×™×
      ok('×™×•× 1 ×”×•× 01.01.2026', fmt(dayToDate(1))==='01.01.2026');
      ok('×™×•× 30 ×”×•× 30.01.2026', fmt(dayToDate(30))==='30.01.2026');

      // highlight
      const h = highlight('×©×œ×•× ×¢×•×œ×','×¢×•×œ');
      ok('highlight ××—×–×™×¨ mark', /<mark/.test(h));

      // ×¨×™× ×“×•×¨ ×•-tip
      const backup = localStorage.getItem(keyFor(1));
      saveDayState(1, {});
      current=1; renderDay();
      const tipEl = document.getElementById('tipSlot');
      ok('×§×™×™× tipSlot ×¢× ×˜×§×¡×˜', !!(tipEl && tipEl.textContent && tipEl.textContent.length>0));
      if(backup===null) localStorage.removeItem(keyFor(1)); else localStorage.setItem(keyFor(1), backup);

      // ××¡× ×Ÿ ××–×•×¨ ××¦××¦×
      activeZoneFilter=null; renderZones(); renderSidebar();
      const before = document.querySelectorAll('.day-btn').length;
      activeZoneFilter='××™×™×'; renderZones(); renderSidebar();
      const after = document.querySelectorAll('.day-btn').length;
      ok('××¡× ×Ÿ ××–×•×¨ ××¦××¦× ×¨×©×™××”', after>0 && after<before);

      // markAll/clearAll
      current=2; renderDay();
      document.getElementById('markAll').click();
      const checks = [...document.querySelectorAll('#todo input[type="checkbox"]')];
      ok('markAll ××¡××Ÿ ×”×›×œ', checks.length>0 && checks.every(c=>c.checked));
      document.getElementById('clearAll').click();
      ok('clearAll ×× ×§×” ×”×›×œ', [...document.querySelectorAll('#todo input[type="checkbox"]')].every(c=>!c.checked));

      // ×™×™×¦×•× ×“××•×™
      saveDayState(3, {0:true}); const exportData={}; itinerary.forEach(d=>{ exportData[d.day]=loadDayState(d.day)});
      ok('×™×™×¦×•× ××›×™×œ ××ª ×™×•× 3 ×¢× ×¢×¨×š', !!exportData[3] && exportData[3][0]===true);

      document.getElementById('testsOut').textContent = out.join('\n');
      console.log(out.join('\n'));
    }catch(e){
      out.push('\n×©×’×™××”: '+e.message);
      document.getElementById('testsOut').textContent = out.join('\n');
      console.error(e);
    }
  }

  // ===== ×”×¤×¢×œ×” ×¨××©×•× ×™×ª =====
  function init(){
    daysTitleEl.textContent = `×”×™××™× ×‘××¡×œ×•×œ (${itinerary.length})`;
    renderZones(); renderJump(); renderSidebar(); goTo(1);
  }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
  </script>
</body>
</html>
